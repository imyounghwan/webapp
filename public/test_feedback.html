<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í”¼ë“œë°± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: #fff; }
        .container { max-width: 800px; margin: 0 auto; }
        .step { background: #2a2a2a; padding: 20px; margin: 20px 0; border-radius: 10px; border-left: 4px solid #0066FF; }
        .step h3 { margin-top: 0; color: #0066FF; }
        button { background: #0066FF; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #0052CC; }
        .success { color: #00C9A7; }
        .error { color: #ef4444; }
        .log { background: #1a1a1a; padding: 15px; border-radius: 6px; margin: 10px 0; font-family: monospace; font-size: 13px; max-height: 300px; overflow-y: auto; }
        .highlight { background: #f59e0b; color: #000; padding: 2px 6px; border-radius: 3px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª í”¼ë“œë°± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
        <p>ê´€ë¦¬ì í‰ê°€ ìˆ˜ì • â†’ AI í•™ìŠµ â†’ ë‹¤ìŒ í‰ê°€ ë°˜ì˜ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸</p>

        <div class="step">
            <h3>1ë‹¨ê³„: ë„¤ì´ë²„ í‰ê°€ (ê¸°ë³¸ ì ìˆ˜)</h3>
            <p>ë„¤ì´ë²„ë¥¼ í‰ê°€í•˜ì—¬ "í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ" í•­ëª©ì˜ ê¸°ë³¸ ì ìˆ˜ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="analyzeNaver()">ë„¤ì´ë²„ í‰ê°€ ì‹œì‘</button>
            <div id="naverResult" class="log" style="display:none;"></div>
        </div>

        <div class="step">
            <h3>2ë‹¨ê³„: ê´€ë¦¬ì ìˆ˜ì • (í”¼ë“œë°± ì €ì¥)</h3>
            <p>UIì—ì„œ ì ìˆ˜ë¥¼ ìˆ˜ì •í•˜ëŠ” ëŒ€ì‹ , APIë¡œ ì§ì ‘ í”¼ë“œë°±ì„ ì „ì†¡í•©ë‹ˆë‹¤.</p>
            <div style="margin: 10px 0;">
                <label>ì›ë˜ ì ìˆ˜: <input type="number" id="originalScore" value="3.0" step="0.1" style="width: 60px;"></label>
                <label>ìˆ˜ì • ì ìˆ˜: <input type="number" id="newScore" value="4.5" step="0.1" style="width: 60px;"></label>
            </div>
            <button onclick="sendFeedback()">í”¼ë“œë°± ì €ì¥ (AI í•™ìŠµ)</button>
            <div id="feedbackResult" class="log" style="display:none;"></div>
        </div>

        <div class="step">
            <h3>3ë‹¨ê³„: ë‹¤ìŒ í‰ê°€ (ë‹¤ë¥¸ ì‚¬ì´íŠ¸)</h3>
            <p>ë‹¤ìŒì„ í‰ê°€í•˜ì—¬ í•™ìŠµëœ íŒ¨í„´ì´ ì ìš©ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="analyzeDaum()">ë‹¤ìŒ í‰ê°€ ì‹œì‘</button>
            <div id="daumResult" class="log" style="display:none;"></div>
        </div>

        <div class="step">
            <h3>4ë‹¨ê³„: ë„¤ì´ë²„ ì¬í‰ê°€ (ë™ì¼ URL)</h3>
            <p>ë„¤ì´ë²„ë¥¼ ë‹¤ì‹œ í‰ê°€í•˜ì—¬ ìˆ˜ì •ëœ ì ìˆ˜ê°€ ê·¸ëŒ€ë¡œ ì ìš©ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="reanalyzeNaver()">ë„¤ì´ë²„ ì¬í‰ê°€</button>
            <div id="naverReResult" class="log" style="display:none;"></div>
        </div>

        <div class="step">
            <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h3>
            <div id="summary" class="log">
                <p>í…ŒìŠ¤íŠ¸ë¥¼ ìˆœì„œëŒ€ë¡œ ì§„í–‰í•´ì£¼ì„¸ìš”...</p>
            </div>
        </div>
    </div>

    <script>
        let naverOriginalScore = null;
        let daumOriginalScore = null;
        let naverNewScore = null;

        // ì„¸ì…˜ ID (í…ŒìŠ¤íŠ¸ìš© - ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ í›„ ë°›ì•„ì˜´)
        const sessionId = 'test-session-' + Date.now();

        async function analyzeNaver() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'í‰ê°€ ì¤‘...';
            
            const resultDiv = document.getElementById('naverResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>â³ ë„¤ì´ë²„ í‰ê°€ ì¤‘...</p>';

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    },
                    body: JSON.stringify({
                        url: 'https://www.naver.com',
                        mode: 'mgine'
                    })
                });

                const data = await response.json();
                
                if (!data.success) {
                    resultDiv.innerHTML = `<p class="error">âŒ ì¸ì¦ í•„ìš”: ${data.error}</p><p>ì‹¤ì œ ë¸Œë¼ìš°ì €ì—ì„œ ë¡œê·¸ì¸ í›„ í…ŒìŠ¤íŠ¸í•´ì£¼ì„¸ìš”.</p>`;
                    return;
                }

                const n1_1_item = data.convenience_items?.find(item => item.item_id === 'N1_1');
                naverOriginalScore = n1_1_item?.score || 0;

                resultDiv.innerHTML = `
                    <p class="success">âœ… ë„¤ì´ë²„ í‰ê°€ ì™„ë£Œ!</p>
                    <p><span class="highlight">í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ (N1_1)</span> ê¸°ë³¸ ì ìˆ˜: <strong>${naverOriginalScore.toFixed(1)}</strong></p>
                    <p>ğŸ“‹ ì§„ë‹¨: ${n1_1_item?.description?.substring(0, 100)}...</p>
                    <p>ğŸ‘‰ ë‹¤ìŒ ë‹¨ê³„: "í”¼ë“œë°± ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì ìˆ˜ë¥¼ ìˆ˜ì •í•˜ê³  AI í•™ìŠµì‹œí‚¤ê¸°</p>
                `;

                document.getElementById('originalScore').value = naverOriginalScore.toFixed(1);
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: ${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ë„¤ì´ë²„ í‰ê°€ ì‹œì‘';
            }
        }

        async function sendFeedback() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'ì €ì¥ ì¤‘...';
            
            const resultDiv = document.getElementById('feedbackResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>â³ í”¼ë“œë°± ì €ì¥ ì¤‘...</p>';

            const originalScore = parseFloat(document.getElementById('originalScore').value);
            const newScore = parseFloat(document.getElementById('newScore').value);
            const delta = newScore - originalScore;

            try {
                const response = await fetch('/api/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    },
                    body: JSON.stringify({
                        url: 'https://www.naver.com',
                        item_id: 'N1_1',
                        item_name: 'í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ',
                        original_score: originalScore,
                        new_score: newScore,
                        new_description: 'Breadcrumb ë„¤ë¹„ê²Œì´ì…˜ì´ ì˜ êµ¬í˜„ë˜ì–´ ìˆì–´ ì‚¬ìš©ìê°€ í˜„ì¬ ìœ„ì¹˜ë¥¼ ëª…í™•íˆ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                        new_recommendation: 'í˜„ì¬ ìƒíƒœë¥¼ ìœ ì§€í•˜ì„¸ìš”. í•„ìš”ì‹œ ëª¨ë°”ì¼ì—ì„œë„ ë™ì¼í•˜ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.',
                        category: 'convenience'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <p class="success">âœ… í”¼ë“œë°± ì €ì¥ ì™„ë£Œ! AI í•™ìŠµ ë°ì´í„°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        <p><span class="highlight">ì ìˆ˜ ë³€ê²½:</span> ${originalScore.toFixed(1)} â†’ ${newScore.toFixed(1)} (Î” ${delta > 0 ? '+' : ''}${delta.toFixed(1)})</p>
                        <p><span class="highlight">ì €ì¥ëœ í”¼ë“œë°±:</span> ${data.total_feedbacks}ê°œ</p>
                        <p>ğŸ’¡ ì´ì œ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ë¥¼ í‰ê°€í•  ë•Œ ì´ ì¡°ì •ê°’ <strong>${delta > 0 ? '+' : ''}${delta.toFixed(1)}</strong>ì´ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤!</p>
                        <p>ğŸ‘‰ ë‹¤ìŒ ë‹¨ê³„: "ë‹¤ìŒ í‰ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í•™ìŠµ íš¨ê³¼ í™•ì¸</p>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">âŒ ì‹¤íŒ¨: ${data.error}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: ${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'í”¼ë“œë°± ì €ì¥ (AI í•™ìŠµ)';
            }
        }

        async function analyzeDaum() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'í‰ê°€ ì¤‘...';
            
            const resultDiv = document.getElementById('daumResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>â³ ë‹¤ìŒ í‰ê°€ ì¤‘...</p>';

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    },
                    body: JSON.stringify({
                        url: 'https://www.daum.net',
                        mode: 'mgine'
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    resultDiv.innerHTML = `<p class="error">âŒ ì¸ì¦ í•„ìš”: ${data.error}</p>`;
                    return;
                }

                const n1_1_item = data.convenience_items?.find(item => item.item_id === 'N1_1');
                daumOriginalScore = n1_1_item?.score || 0;

                const expectedDelta = parseFloat(document.getElementById('newScore').value) - parseFloat(document.getElementById('originalScore').value);
                const wasApplied = Math.abs(daumOriginalScore - (naverOriginalScore + expectedDelta)) < 0.5;

                resultDiv.innerHTML = `
                    <p class="success">âœ… ë‹¤ìŒ í‰ê°€ ì™„ë£Œ!</p>
                    <p><span class="highlight">í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ (N1_1)</span> ì ìˆ˜: <strong>${daumOriginalScore.toFixed(1)}</strong></p>
                    <p>ğŸ“Š ë¶„ì„:</p>
                    <ul>
                        <li>ë„¤ì´ë²„ ê¸°ë³¸ ì ìˆ˜: ${naverOriginalScore?.toFixed(1)}</li>
                        <li>í•™ìŠµëœ ì¡°ì •ê°’: ${expectedDelta > 0 ? '+' : ''}${expectedDelta.toFixed(1)}</li>
                        <li>ë‹¤ìŒ ìµœì¢… ì ìˆ˜: ${daumOriginalScore.toFixed(1)}</li>
                        <li>${wasApplied ? '<span class="success">âœ… í•™ìŠµ íŒ¨í„´ ì ìš©ë¨!</span>' : '<span class="error">âš ï¸ ì¡°ì •ê°’ì´ ì˜ˆìƒê³¼ ë‹¤ë¦„</span>'}</li>
                    </ul>
                    <p>ğŸ‘‰ ë‹¤ìŒ ë‹¨ê³„: "ë„¤ì´ë²„ ì¬í‰ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë™ì¼ URL ì²˜ë¦¬ í™•ì¸</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: ${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ë‹¤ìŒ í‰ê°€ ì‹œì‘';
            }
        }

        async function reanalyzeNaver() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'ì¬í‰ê°€ ì¤‘...';
            
            const resultDiv = document.getElementById('naverReResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>â³ ë„¤ì´ë²„ ì¬í‰ê°€ ì¤‘...</p>';

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    },
                    body: JSON.stringify({
                        url: 'https://www.naver.com',
                        mode: 'mgine'
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    resultDiv.innerHTML = `<p class="error">âŒ ì¸ì¦ í•„ìš”: ${data.error}</p>`;
                    return;
                }

                const n1_1_item = data.convenience_items?.find(item => item.item_id === 'N1_1');
                naverNewScore = n1_1_item?.score || 0;

                const expectedScore = parseFloat(document.getElementById('newScore').value);
                const isExactMatch = Math.abs(naverNewScore - expectedScore) < 0.1;

                resultDiv.innerHTML = `
                    <p class="success">âœ… ë„¤ì´ë²„ ì¬í‰ê°€ ì™„ë£Œ!</p>
                    <p><span class="highlight">í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ (N1_1)</span> ì ìˆ˜: <strong>${naverNewScore.toFixed(1)}</strong></p>
                    <p>ğŸ“Š ë¶„ì„:</p>
                    <ul>
                        <li>ì´ì „ ê¸°ë³¸ ì ìˆ˜: ${naverOriginalScore?.toFixed(1)}</li>
                        <li>ê´€ë¦¬ì ìˆ˜ì • ì ìˆ˜: ${expectedScore.toFixed(1)}</li>
                        <li>ì¬í‰ê°€ ì ìˆ˜: ${naverNewScore.toFixed(1)}</li>
                        <li>${isExactMatch ? '<span class="success">âœ… ìˆ˜ì • ì ìˆ˜ ì •í™•íˆ ì ìš©ë¨! (exact match)</span>' : '<span class="error">âš ï¸ ì ìˆ˜ê°€ ì˜ˆìƒê³¼ ë‹¤ë¦„</span>'}</li>
                    </ul>
                `;

                updateSummary();
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: ${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ë„¤ì´ë²„ ì¬í‰ê°€';
            }
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            const originalScore = parseFloat(document.getElementById('originalScore').value);
            const newScore = parseFloat(document.getElementById('newScore').value);
            const delta = newScore - originalScore;

            summaryDiv.innerHTML = `
                <h4>ğŸ¯ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¢…í•©</h4>
                <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                    <tr style="border-bottom: 1px solid #444;">
                        <th style="text-align: left; padding: 8px;">ë‹¨ê³„</th>
                        <th style="text-align: right; padding: 8px;">ì ìˆ˜</th>
                        <th style="text-align: left; padding: 8px;">ìƒíƒœ</th>
                    </tr>
                    <tr style="border-bottom: 1px solid #333;">
                        <td style="padding: 8px;">1. ë„¤ì´ë²„ ê¸°ë³¸ ì ìˆ˜</td>
                        <td style="text-align: right; padding: 8px;"><strong>${naverOriginalScore?.toFixed(1) || '-'}</strong></td>
                        <td style="padding: 8px;">AI ìë™ í‰ê°€</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #333;">
                        <td style="padding: 8px;">2. ê´€ë¦¬ì ìˆ˜ì •</td>
                        <td style="text-align: right; padding: 8px;"><strong>${newScore.toFixed(1)}</strong></td>
                        <td style="padding: 8px;"><span class="highlight">Î” ${delta > 0 ? '+' : ''}${delta.toFixed(1)}</span> í•™ìŠµ</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #333;">
                        <td style="padding: 8px;">3. ë‹¤ìŒ í‰ê°€ (ë‹¤ë¥¸ URL)</td>
                        <td style="text-align: right; padding: 8px;"><strong>${daumOriginalScore?.toFixed(1) || '-'}</strong></td>
                        <td style="padding: 8px;">${daumOriginalScore ? '<span class="success">âœ… í‰ê·  ì¡°ì • ì ìš©</span>' : '-'}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">4. ë„¤ì´ë²„ ì¬í‰ê°€ (ë™ì¼ URL)</td>
                        <td style="text-align: right; padding: 8px;"><strong>${naverNewScore?.toFixed(1) || '-'}</strong></td>
                        <td style="padding: 8px;">${naverNewScore ? '<span class="success">âœ… ìˆ˜ì • ì ìˆ˜ ì ìš©</span>' : '-'}</td>
                    </tr>
                </table>

                <h4 style="margin-top: 20px;">âœ¨ í•µì‹¬ ê²€ì¦ í¬ì¸íŠ¸</h4>
                <ul>
                    <li>âœ… í”¼ë“œë°± ì €ì¥: ê´€ë¦¬ì ìˆ˜ì • â†’ AI í•™ìŠµ ë°ì´í„° ì €ì¥</li>
                    <li>âœ… ë‹¤ë¥¸ URL í‰ê°€: í•™ìŠµëœ ì¡°ì •ê°’ ìë™ ì ìš©</li>
                    <li>âœ… ë™ì¼ URL ì¬í‰ê°€: ìˆ˜ì • ì ìˆ˜ ê·¸ëŒ€ë¡œ ì‚¬ìš© (exact match)</li>
                    <li>âœ… í‰ê°€ ì •í™•ë„ í–¥ìƒ: AIê°€ ê´€ë¦¬ì í”¼ë“œë°±ìœ¼ë¡œ ì§€ì† í•™ìŠµ</li>
                </ul>

                <p style="margin-top: 20px; padding: 15px; background: #0066FF20; border-left: 4px solid #0066FF; border-radius: 6px;">
                    ğŸ’¡ <strong>ê²°ë¡ :</strong> ê´€ë¦¬ìê°€ ìˆ˜ì •í•œ í‰ê°€ ê²°ê³¼ê°€ ì¦‰ì‹œ AI í‰ê°€ ë¡œì§ì— ë°˜ì˜ë˜ì–´,<br>
                    ë‹¤ìŒ ì‚¬ì´íŠ¸ í‰ê°€ ì‹œ í•™ìŠµëœ íŒ¨í„´ì´ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤! ğŸ‰
                </p>
            `;
        }
    </script>
</body>
</html>
